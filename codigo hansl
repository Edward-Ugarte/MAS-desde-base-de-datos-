# ===========================
# ğŸ§® EstimaciÃ³n de tamaÃ±o muestral e IC
# Basado en datos de ingresos â€“ MÃ©todos A, B y C
# VersiÃ³n final optimizada por Edward Ugarte
# ===========================

clear

# ğŸ“ Abrir base de datos
open "BdD.gdt"

# ğŸ“Š ParÃ¡metros derivados de la serie "ingresos"
scalar sigma2 = var(ingresos)            # Varianza muestral
scalar sigma  = sqrt(sigma2)             # DesvÃ­o estÃ¡ndar
scalar media  = mean(ingresos)           # Media muestral
scalar N      = sum(ok(ingresos))        # Total de observaciones vÃ¡lidas
scalar E      = 15                       # Error mÃ¡ximo permitido
scalar Z      = 1.96                     # Z para 95% de confianza

# ğŸ”§ EstimaciÃ³n del tamaÃ±o muestral por tres mÃ©todos
scalar n_A1 = (Z^2 * sigma2) / E^2
scalar n_A  = n_A1 / (1 + n_A1 / N)

scalar n_B  = (N * Z^2 * sigma2) / (N * E^2 + Z^2 * sigma2)
scalar n_C  = sigma2 / ((E / Z)^2 + (sigma2 / N))

# ğŸ¯ Redondeo operativo basado en MÃ©todo A
scalar n_final = ceil(n_A)

# ğŸ“Œ Resultados de tamaÃ±o muestral
printf "ğŸš€ ==== EstimaciÃ³n del tamaÃ±o muestral ====\n"
printf "ğŸ“Š MÃ©todo A (ajustado): %.3f\n", n_A
printf "ğŸ“Š MÃ©todo B: %.3f\n", n_B
printf "ğŸ“Š MÃ©todo C: %.3f\n", n_C
printf "âœ… TamaÃ±o muestral final a usar (redondeado): %.0f\n", n_final

# ğŸ§® Intervalo de confianza usando n_final
scalar f      = n_final / N
scalar margen = Z * sigma / sqrt(n_final) * sqrt(1 - f)
scalar inf    = media - margen
scalar sup    = media + margen

# ğŸ§¾ Resultados del intervalo de confianza
printf "\nğŸ“ Intervalo de confianza al 95%% (n = %.0f):\n", n_final
printf "   - Media esperada     : %.2f\n", media
printf "   - Margen de error    : %.2f\n", margen
printf "   - LÃ­mite inferior    : %.2f\n", inf
printf "   - LÃ­mite superior    : %.2f\n", sup
